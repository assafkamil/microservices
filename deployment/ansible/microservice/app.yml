- hosts: all
  become: yes
  become_method: sudo

  roles:
        - redouane.java
        - Stouts.supervisor
        - tumf.newrelic

  post_tasks:
        - name: add new relic labels
          shell: echo "labels=Environment:{{ newrelic_env }};Microservice:{{ microservice_name }}" > /etc/newrelic/nrsysmond.cfg

  vars:
        supervisor_tasks:
            - name: springboot
              command: java -Dserver.port={{ port }} -Dspring.profiles.active={{ active_profile }} -Dnewrelic.config.process_host.display_name={{ microservice_name }} -Dnewrelic.environment={{ newrelic_env }} -Dnewrelic.config.labels="labels=Environment:{{ newrelic_env }};Microservice:{{ microservice_name }}" â€”jar {{ jar }}
              autostart: true
              autorestart: true
        newrelic_license_key: 6e90092241cead6c8eb58906436eed910e58ab29
        newrelic_service_state: started
